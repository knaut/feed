{"version":3,"sources":["../server/index.js"],"names":["require","enforceHttps","resolver","xForwardedProtoResolver","app","Koa","router","Router","oneDayMs","oneYearMs","base","__dirname","console","log","staticHandler","ctx","use","origin","credentials","get","routes","PORT","process","env","listen"],"mappings":";;AAWA;;AACA;;AAGA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAOA;;AAGA;;;;;;;;eANIA,OAAO,CAAC,YAAD,C;IAFAC,Y;IACgBC,Q,YAAzBC,uB,EAGF;;;AAMA,IAAMC,GAAG,GAAG,IAAIC,eAAJ,EAAZ;AACA,IAAMC,MAAM,GAAG,IAAIC,qBAAJ,EAAf,C,CAEA;;AACA,IAAMC,QAAQ,GAAG,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAlC;AACA,IAAMC,SAAS,GAAGD,QAAQ,GAAG,GAA7B;AAEA,IAAME,IAAI,GAAG,0BAASC,SAAT,CAAb;AACAC,OAAO,CAACC,GAAR,CAAYH,IAAZ;;AAEA,IAAMI,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAG,iBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA,6CAAa,yBAAQA,GAAR,sBAAb;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAbD,aAAa;AAAA;AAAA;AAAA,GAAnB,C,CAEA;;;AACAV,GAAG,CAACY,GAAJ,CAAQ,yBAAR;AACAZ,GAAG,CAACY,GAAJ,CAAQ,4BAAR;AACAZ,GAAG,CAACY,GAAJ,CAAQf,YAAY,CAAC;AAAEC,EAAAA,QAAQ,EAARA;AAAF,CAAD,CAApB;AACAE,GAAG,CAACY,GAAJ,CAAQ,sBAAK;AACXC,EAAAA,MAAM,EAAE,gCADG;AAEXC,EAAAA,WAAW,EAAE;AAFF,CAAL,CAAR;AAIAd,GAAG,CAACY,GAAJ,CAAQ,2BAAO,SAAP,CAAR,E,CAA4B;AAE5B;;AACA;;AACAV,MAAM,CAACa,GAAP,CAAW,GAAX,EAAgBL,aAAhB;AACAR,MAAM,CAACa,GAAP,CAAW,OAAX,EAAoBL,aAApB;AACAR,MAAM,CAACa,GAAP,CAAW,YAAX,EAAyBL,aAAzB;AAEAV,GAAG,CAACY,GAAJ,CAAQV,MAAM,CAACc,MAAP,EAAR;AAGA,IAAMC,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYF,IAAZ,GAAmBC,OAAO,CAACC,GAAR,CAAYF,IAA/B,GAAsC,IAAnD,C,CAEA;;AACAjB,GAAG,CAACoB,MAAJ,CAAWH,IAAX;AAEA,6CAAqBA,IAArB","sourcesContent":["/*\n  _____                .____________\n_/ ____\\____  ____   __| _/   _____/ ______________  __ ___________\n\\   __\\/ __ \\/ __ \\ / __ |\\_____  \\_/ __ \\_  __ \\  \\/ // __ \\_  __ \\\n |  | \\  ___|  ___// /_/ |/        \\  ___/|  | \\/\\   /\\  ___/|  | \\/\n |__|  \\___  >___  >____ /_______  /\\___  >__|    \\_/  \\___  >__|\n           \\/    \\/     \\/       \\/     \\/                 \\/\n\n           Serve Feed web app files in a simple way.\n*/\n// IMPORTS\nimport '@babel/polyfill'\nimport findRoot from 'find-root'\n\n// KOA\nimport Koa from 'koa'\nimport logger from 'koa-logger'\nimport assets from 'koa-static'\nimport Router from 'koa-router'\nimport koaSend from 'koa-send'\nimport cors from '@koa/cors'\nconst {\n  default: enforceHttps,\n  xForwardedProtoResolver: resolver \n} = require('koa-sslify');\n\n// MIDDLEWARE\nimport errors from './middleware/errors.js'\n\n// UTILS\nimport welcome from './utils/welcome'\n\nconst app = new Koa()\nconst router = new Router()\n\n// ROUTES\nconst oneDayMs = 1000 * 60 * 60 * 24;\nconst oneYearMs = oneDayMs * 365;\n\nconst base = findRoot(__dirname)\nconsole.log(base)\n\nconst staticHandler = async ctx => koaSend(ctx, `/build/index.html`)\n\n// ATTACH MIDDLEWARE\napp.use(errors())\napp.use(logger())\napp.use(enforceHttps({ resolver }));\napp.use(cors({\n  origin: 'https://browser.blockstack.org',\n  credentials: true\n}))\napp.use(assets('./build'))  // keep static assets at the top for routing priority\n\n// SPA PAGE ROUTES\n/* these are for one a user refreshes on a given SPA route */\nrouter.get('/', staticHandler)\nrouter.get('/(.*)', staticHandler)\nrouter.get('/(.*)/feed', staticHandler)\n\napp.use(router.routes())\n\n\nconst PORT = process.env.PORT ? process.env.PORT : 3000\n\n// START\napp.listen(PORT)\n\nwelcome(`localhost:${PORT}`)\n"],"file":"index.js"}